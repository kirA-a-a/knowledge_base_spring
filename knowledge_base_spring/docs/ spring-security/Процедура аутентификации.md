# üîë –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ Spring Security

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
- [üöÄ –í–≤–µ–¥–µ–Ω–∏–µ](#-–≤–≤–µ–¥–µ–Ω–∏–µ)
- [üîé –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤ Spring Security](#-–∫–∞–∫-—Ä–∞–±–æ—Ç–∞–µ—Ç-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è-–≤-spring-security)
- [üñºÔ∏è –°—Ö–µ–º–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏](#Ô∏è-—Å—Ö–µ–º–∞-–ø—Ä–æ—Ü–µ—Å—Å–∞-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)
- [‚öôÔ∏è –ö–ª—é—á–µ–≤—ã–µ –∫–ª–∞—Å—Å—ã –∏ –∏—Ö —Ä–æ–ª—å](#Ô∏è-–∫–ª—é—á–µ–≤—ã–µ-–∫–ª–∞—Å—Å—ã-–∏-–∏—Ö-—Ä–æ–ª—å)
- [üìù –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∫–æ–Ω—Ñ–∏–≥](#-–ø—Ä–∏–º–µ—Ä-–∫–æ–¥–∞-–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è-–∏-–∫–æ–Ω—Ñ–∏–≥)
- [üí° –ü—Ä–∏–º–µ—Ä: —Ñ–æ—Ä–º–∞ –ª–æ–≥–∏–Ω–∞ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç](#-–ø—Ä–∏–º–µ—Ä-—Ñ–æ—Ä–º–∞-–ª–æ–≥–∏–Ω–∞-–∏-—Ä–µ–∑—É–ª—å—Ç–∞—Ç)
- [üì¶ In-memory vs. –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#-in-memory-vs-–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
- [‚ùì FAQ –∏ —Ç–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏](#-faq-–∏-—Ç–∏–ø–∏—á–Ω—ã–µ-–æ—à–∏–±–∫–∏)
- [üèÅ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ](#-–∑–∞–∫–ª—é—á–µ–Ω–∏–µ)

---

## üöÄ –í–≤–µ–¥–µ–Ω–∏–µ

–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Äî —ç—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–∏—á–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –í Spring Security –æ–Ω–∞ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Ü–µ–ø–æ—á–∫—É —Ñ–∏–ª—å—Ç—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç HTTP-–∑–∞–ø—Ä–æ—Å—ã –∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç, –∫—Ç–æ –∏ —á—Ç–æ –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.

---

## üîé –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤ Spring Security

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ª–æ–≥–∏–Ω —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É).
2. –ó–∞–ø—Ä–æ—Å –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ —Ü–µ–ø–æ—á–∫—É —Ñ–∏–ª—å—Ç—Ä–æ–≤ Spring Security.
3. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω ‚Äî –µ–≥–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞.
4. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –ª–æ–≥–∏–Ω–∞/–ø–∞—Ä–æ–ª—è —Å–æ–∑–¥–∞—ë—Ç—Å—è –æ–±—ä–µ–∫—Ç Authentication –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ SecurityContext.
5. –î–∞–ª—å–Ω–µ–π—à–∏–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —Å —É—á—ë—Ç–æ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ —Ä–æ–ª–µ–π.

---

## üñºÔ∏è –°—Ö–µ–º–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

```mermaid
graph TD
    A[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å] -->|HTTP –∑–∞–ø—Ä–æ—Å| B[Security Filter Chain]
    B -->|/login| C[UsernamePasswordAuthenticationFilter]
    C --> D{–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–Ω–∞/–ø–∞—Ä–æ–ª—è}
    D -- –î–∞ --> E[AuthenticationManager]
    E --> F[UserDetailsService]
    F --> G[UserDetails]
    G --> H[–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è PasswordEncoder]
    H -- –£—Å–ø–µ—Ö --> I[SecurityContext]
    I --> J[–î–æ—Å—Ç—É–ø –∫ –∑–∞—â–∏—â—ë–Ω–Ω—ã–º —Ä–µ—Å—É—Ä—Å–∞–º]
    D -- –ù–µ—Ç --> K[–û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏]
```

---

## ‚öôÔ∏è –ö–ª—é—á–µ–≤—ã–µ –∫–ª–∞—Å—Å—ã –∏ –∏—Ö —Ä–æ–ª—å

| –ö–ª–∞—Å—Å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|------------|
| `AbstractSecurityWebApplicationInitializer` | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç —Ñ–∏–ª—å—Ç—Ä—ã Spring Security |
| `WebSecurityConfigurerAdapter` | –ü–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ |
| `UserDetailsService` | –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–∏–∑ –ø–∞–º—è—Ç–∏, –ë–î –∏ —Ç.–¥.) |
| `PasswordEncoder` | –®–∏—Ñ—Ä—É–µ—Ç –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–∞—Ä–æ–ª–∏ |
| `AuthenticationManager` | –£–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ |
| `SecurityContext` | –•—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ |

---

## üìù –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∫–æ–Ω—Ñ–∏–≥

**1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä:**
```java
package com.safronov.spring.security.configuration;

import org.springframework.security.web.context.AbstractSecurityWebApplicationInitializer;

public class MySecurityInitializer extends AbstractSecurityWebApplicationInitializer {
    // –ü—Ä–æ—Å—Ç–æ –Ω–∞—Å–ª–µ–¥—É–µ–º ‚Äî —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–∞—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
}
```

**2. –ö–æ–Ω—Ñ–∏–≥ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:**
```java
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
import org.springframework.security.core.userdetails.User;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;

@Configuration
@EnableWebSecurity
public class MySecurityConfig extends WebSecurityConfigurerAdapter {
    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
        User.UserBuilder userBuilder = User.builder();
        auth.inMemoryAuthentication()
            .withUser(userBuilder.username("zaur").password(passwordEncoder().encode("zaur")).roles("EMPLOYEE"))
            .withUser(userBuilder.username("elena").password(passwordEncoder().encode("elena")).roles("HR"))
            .withUser(userBuilder.username("ivan").password(passwordEncoder().encode("ivan")).roles("MANAGER", "HR"));
    }
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}
```

---

## üí° –ü—Ä–∏–º–µ—Ä: —Ñ–æ—Ä–º–∞ –ª–æ–≥–∏–Ω–∞ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**login.jsp:**
```jsp
<form action="${pageContext.request.contextPath}/login" method="post">
    <label>–õ–æ–≥–∏–Ω: <input type="text" name="username"/></label><br/>
    <label>–ü–∞—Ä–æ–ª—å: <input type="password" name="password"/></label><br/>
    <button type="submit">–í–æ–π—Ç–∏</button>
</form>
<c:if test="${not empty param.error}">
    <div style="color:red">–û—à–∏–±–∫–∞: –Ω–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å</div>
</c:if>
```

**–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä (–ø—Ä–∏–º–µ—Ä):**
```java
@GetMapping("/")
public String home(Model model) {
    Authentication auth = SecurityContextHolder.getContext().getAuthentication();
    model.addAttribute("username", auth.getName());
    return "home";
}
```

---

## üì¶ In-memory vs. –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

- **In-memory** ‚Äî –ø—Ä–æ—Å—Ç–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –∏ –¥–µ–º–æ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ JVM.
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** ‚Äî –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ JDBC –∏–ª–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–π UserDetailsService.

```mermaid
graph LR
    A[InMemoryUserDetailsManager] -- –ë—ã—Å—Ç—Ä–æ, –ø—Ä–æ—Å—Ç–æ --> B[–¢–µ—Å—Ç—ã, –¥–µ–º–æ]
    C[JdbcUserDetailsManager] -- –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ --> D[–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö]
```

---

## ‚ùì FAQ –∏ —Ç–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏

**Q: –ü–æ—á–µ–º—É –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è?**
- –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä –∏ –∫–æ–Ω—Ñ–∏–≥ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã
- –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –ø–∞—Ä–æ–ª–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç (–∏ –Ω–µ –∑–∞–±—ã–≤–∞–π –ø—Ä–æ PasswordEncoder)

**Q: –ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞?**
- –í –∫–æ–Ω—Ñ–∏–≥–µ –¥–æ–±–∞–≤—å `.formLogin().loginPage("/login")`
- –°–æ–∑–¥–∞–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏ JSP –¥–ª—è `/login`

**Q: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å —Ä–æ–ª–∏?**
- –í inMemory ‚Äî —á–µ—Ä–µ–∑ `.roles("ROLE")`
- –í –ë–î ‚Äî —á–µ—Ä–µ–∑ —Ç–∞–±–ª–∏—Ü—É —Ä–æ–ª–µ–π

**Q: –ö–∞–∫ –æ—Ç–ª–∞–¥–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å?**
- –í–∫–ª—é—á–∏ debug: `@EnableWebSecurity(debug = true)`
- –õ–æ–≥–∏—Ä—É–π: `logging.level.org.springframework.security=DEBUG`

---

## üèÅ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

- Spring Security –¥–µ–ª–∞–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≥–∏–±–∫–æ–π –∏ –º–æ—â–Ω–æ–π
- –î–ª—è –Ω–æ–≤–∏—á–∫–æ–≤: –Ω–∞—á–Ω–∏ —Å in-memory, –ø–æ—Ç–æ–º –ø–µ—Ä–µ—Ö–æ–¥–∏ –Ω–∞ –ë–î
- –ò—Å–ø–æ–ª—å–∑—É–π PasswordEncoder –≤—Å–µ–≥–¥–∞, –¥–∞–∂–µ –¥–ª—è —Ç–µ—Å—Ç–æ–≤
- –í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–π –ø—Ä–æ—Ü–µ—Å—Å ‚Äî —ç—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–Ω—è—Ç—å, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

