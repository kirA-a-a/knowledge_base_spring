# üîê –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Spring Security

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
- [üéØ –ß—Ç–æ —Ç–∞–∫–æ–µ Spring Security?](#-—á—Ç–æ-—Ç–∞–∫–æ–µ-spring-security)
- [üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Spring Security](#Ô∏è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-spring-security)
- [‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞](#Ô∏è-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏](#-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
- [üë• –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è](#-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è-–∏-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è)
- [üõ°Ô∏è –ó–∞—â–∏—Ç–∞ URL](#Ô∏è-–∑–∞—â–∏—Ç–∞-url)
- [üîë –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π](#-—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ-–ø–∞—Ä–æ–ª–µ–π)
- [üìù –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä](#-–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π-–ø—Ä–∏–º–µ—Ä)
- [‚ùì –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã](#-—á–∞—Å—Ç–æ-–∑–∞–¥–∞–≤–∞–µ–º—ã–µ-–≤–æ–ø—Ä–æ—Å—ã)

---

## üéØ –ß—Ç–æ —Ç–∞–∫–æ–µ Spring Security?

Spring Security ‚Äî —ç—Ç–æ –º–æ—â–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤ Spring-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö. –û–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—É—é —Å–∏—Å—Ç–µ–º—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –∑–∞—â–∏—Ç—ã –æ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∞—Ç–∞–∫.

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- ‚úÖ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ—Å—É—Ä—Å–∞–º
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF, XSS –∞—Ç–∞–∫
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ JWT —Ç–æ–∫–µ–Ω–æ–≤

```mermaid
graph TD
    A[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å] --> B[Spring Security Filter Chain]
    B --> C{–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è}
    C -->|–£—Å–ø–µ—à–Ω–æ| D[–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è]
    C -->|–ù–µ—É–¥–∞—á–Ω–æ| E[–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω]
    D --> F{–ï—Å—Ç—å –ø—Ä–∞–≤–∞?}
    F -->|–î–∞| G[–î–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å—É]
    F -->|–ù–µ—Ç| E
    G --> H[–ó–∞—â–∏—â–µ–Ω–Ω—ã–π —Ä–µ—Å—É—Ä—Å]
```

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Spring Security

Spring Security —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ —Ü–µ–ø–æ—á–∫—É —Ñ–∏–ª—å—Ç—Ä–æ–≤ (Filter Chain), –∫–æ—Ç–æ—Ä–∞—è –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ HTTP-–∑–∞–ø—Ä–æ—Å—ã.

```mermaid
graph LR
    A[HTTP Request] --> B[Security Filter Chain]
    B --> C[UsernamePasswordAuthenticationFilter]
    C --> D[BasicAuthenticationFilter]
    D --> E[SecurityContextPersistenceFilter]
    E --> F[Application]
    
    G[AuthenticationManager] --> C
    H[UserDetailsService] --> G
    I[PasswordEncoder] --> G
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|------------|
| **Filter Chain** | –¶–µ–ø–æ—á–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ |
| **AuthenticationManager** | –£–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ |
| **UserDetailsService** | –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö |
| **PasswordEncoder** | –®–∏—Ñ—Ä—É–µ—Ç –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–∞—Ä–æ–ª–∏ |
| **SecurityContext** | –•—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ |

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

### 1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ `pom.xml`

```xml
<project xmlns="http://maven.apache.org/POM/4.0.0" 
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
         http://maven.apache.org/maven-v4_0_0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <groupId>com.safronov.spring.security</groupId>
    <artifactId>spring_security</artifactId>
    <packaging>war</packaging>
    <version>1.0-SNAPSHOT</version>
    <name>spring_security Maven Webapp</name>
    <url>http://maven.apache.org</url>
    
    <properties>
        <maven.compiler.source>8</maven.compiler.source>
        <maven.compiler.target>8</maven.compiler.target>
        <spring.version>5.2.9.RELEASE</spring.version>
        <spring.security.version>5.4.1</spring.security.version>
    </properties>
    
    <dependencies>
        <!-- Spring MVC -->
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-webmvc</artifactId>
            <version>${spring.version}</version>
        </dependency>
        
        <!-- Spring Security Web -->
        <dependency>
            <groupId>org.springframework.security</groupId>
            <artifactId>spring-security-web</artifactId>
            <version>${spring.security.version}</version>
        </dependency>
        
        <!-- Spring Security Config -->
        <dependency>
            <groupId>org.springframework.security</groupId>
            <artifactId>spring-security-config</artifactId>
            <version>${spring.security.version}</version>
        </dependency>
        
        <!-- Servlet API -->
        <dependency>
            <groupId>javax.servlet</groupId>
            <artifactId>javax.servlet-api</artifactId>
            <version>4.0.1</version>
            <scope>provided</scope>
        </dependency>
        
        <!-- JUnit –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>4.11</version>
            <scope>test</scope>
        </dependency>
    </dependencies>
    
    <build>
        <finalName>spring_security</finalName>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-compiler-plugin</artifactId>
                <version>3.8.1</version>
                <configuration>
                    <source>8</source>
                    <target>8</target>
                </configuration>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-war-plugin</artifactId>
                <version>3.2.2</version>
            </plugin>
        </plugins>
    </build>
</project>
```

### 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ main/
‚îÇ   ‚îú‚îÄ‚îÄ java/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ com/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ safronov/
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ spring/
‚îÇ   ‚îÇ               ‚îú‚îÄ‚îÄ configuration/
‚îÇ   ‚îÇ               ‚îÇ   ‚îú‚îÄ‚îÄ MyConfig.java
‚îÇ   ‚îÇ               ‚îÇ   ‚îú‚îÄ‚îÄ MySecurityConfig.java
‚îÇ   ‚îÇ               ‚îÇ   ‚îú‚îÄ‚îÄ MyWebInitializer.java
‚îÇ   ‚îÇ               ‚îÇ   ‚îî‚îÄ‚îÄ MySecurityInitializer.java
‚îÇ   ‚îÇ               ‚îú‚îÄ‚îÄ controller/
‚îÇ   ‚îÇ               ‚îÇ   ‚îî‚îÄ‚îÄ MyController.java
‚îÇ   ‚îÇ               ‚îî‚îÄ‚îÄ model/
‚îÇ   ‚îÇ                   ‚îî‚îÄ‚îÄ Employee.java
‚îÇ   ‚îú‚îÄ‚îÄ resources/
‚îÇ   ‚îî‚îÄ‚îÄ webapp/
‚îÇ       ‚îî‚îÄ‚îÄ WEB-INF/
‚îÇ           ‚îî‚îÄ‚îÄ view/
‚îÇ               ‚îî‚îÄ‚îÄ jsp/
‚îÇ                   ‚îú‚îÄ‚îÄ home.jsp
‚îÇ                   ‚îî‚îÄ‚îÄ login.jsp
‚îî‚îÄ‚îÄ test/
    ‚îî‚îÄ‚îÄ java/
        ‚îî‚îÄ‚îÄ com/
            ‚îî‚îÄ‚îÄ safronov/
                ‚îî‚îÄ‚îÄ spring/
                    ‚îî‚îÄ‚îÄ AppTest.java
```

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 1. –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –∫–ª–∞—Å—Å

```java
package com.safronov.spring.configuration;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.ViewResolver;
import org.springframework.web.servlet.config.annotation.EnableWebMvc;
import org.springframework.web.servlet.view.InternalResourceViewResolver;

@Configuration
@ComponentScan("com.safronov.spring")
@EnableWebMvc
public class MyConfig {

    @Bean
    public ViewResolver viewResolver() {
        InternalResourceViewResolver viewResolver = new InternalResourceViewResolver();
        viewResolver.setPrefix("/WEB-INF/view/jsp/");
        viewResolver.setSuffix(".jsp");
        return viewResolver;
    }
}
```

### 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä Dispatcher Servlet

```java
package com.safronov.spring.configuration;

import org.springframework.web.servlet.support.AbstractAnnotationConfigDispatcherServletInitializer;

public class MyWebInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {
    
    @Override
    protected Class<?>[] getRootConfigClasses() {
        return null;
    }

    @Override
    protected Class<?>[] getServletConfigClasses() {
        return new Class[] {MyConfig.class};
    }

    @Override
    protected String[] getServletMappings() {
        return new String[]{"/"};
    }
}
```

### 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä Spring Security

```java
package com.safronov.spring.configuration;

import org.springframework.security.web.context.AbstractSecurityWebApplicationInitializer;

public class MySecurityInitializer extends AbstractSecurityWebApplicationInitializer {
    // –≠—Ç–æ—Ç –∫–ª–∞—Å—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ñ–∏–ª—å—Ç—Ä—ã Spring Security
}
```

---

## üë• –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

### –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```mermaid
graph TD
    A[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏] --> B[EMPLOYEE]
    A --> C[HR]
    A --> D[MANAGER]
    
    B --> E[–î–æ—Å—Ç—É–ø –∫ –±–∞–∑–æ–≤—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º]
    C --> F[–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º]
    D --> G[–ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø]
    D --> F
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å —Ä–æ–ª—è–º–∏

```java
package com.safronov.spring.configuration;

import org.springframework.context.annotation.Bean;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
import org.springframework.security.core.userdetails.User;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;

@EnableWebSecurity
public class MySecurityConfig extends WebSecurityConfigurerAdapter {

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
        User.UserBuilder userBuilder = User.builder();

        auth.inMemoryAuthentication()
                .withUser(userBuilder
                    .username("zaur")
                    .password(passwordEncoder().encode("zaur"))
                    .roles("EMPLOYEE"))
                .withUser(userBuilder
                    .username("elena")
                    .password(passwordEncoder().encode("elena"))
                    .roles("HR"))
                .withUser(userBuilder
                    .username("ivan")
                    .password(passwordEncoder().encode("ivan"))
                    .roles("MANAGER", "HR"));
    }

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.authorizeRequests()
                .antMatchers("/").hasAnyRole("EMPLOYEE", "HR", "MANAGER")
                .antMatchers("/hr_info").hasRole("HR")
                .antMatchers("/manager_info").hasRole("MANAGER")
                .and()
                .formLogin()
                    .loginPage("/showMyLoginPage")
                    .loginProcessingUrl("/authenticateTheUser")
                    .permitAll()
                .and()
                .logout()
                    .permitAll()
                .and()
                .exceptionHandling()
                    .accessDeniedPage("/access-denied");
    }
}
```

---

## üõ°Ô∏è –ó–∞—â–∏—Ç–∞ URL

### –ò–µ—Ä–∞—Ä—Ö–∏—è —Ä–æ–ª–µ–π –∏ –¥–æ—Å—Ç—É–ø–æ–≤

```mermaid
graph TD
    A[–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏] --> B[EMPLOYEE]
    B --> C[HR]
    C --> D[MANAGER]
    
    B --> E[/ - –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞]
    C --> F[/hr_info - HR –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è]
    D --> G[/manager_info - –ú–µ–Ω–µ–¥–∂–µ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è]
    D --> H[/admin - –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å]
```

### –ê–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –¥–ª—è –∑–∞—â–∏—Ç—ã –º–µ—Ç–æ–¥–æ–≤

```java
package com.safronov.spring.controller;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.security.access.prepost.PreAuthorize;

@Controller
public class MyController {

    @GetMapping("/")
    public String getHomePage() {
        return "home";
    }

    @GetMapping("/hr_info")
    @PreAuthorize("hasRole('HR')")
    public String getHRInfo() {
        return "hr_info";
    }

    @GetMapping("/manager_info")
    @PreAuthorize("hasRole('MANAGER')")
    public String getManagerInfo() {
        return "manager_info";
    }
}
```

---

## üîë –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π

### –¢–∏–ø—ã —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è

| –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å |
|-----|----------|--------------|
| **BCrypt** | –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| **SCrypt** | –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| **Argon2** | –ù–æ–≤–µ–π—à–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| **MD5** | –£—Å—Ç–∞—Ä–µ–≤—à–∏–π | ‚ùå |
| **SHA-1** | –£—Å—Ç–∞—Ä–µ–≤—à–∏–π | ‚ùå |

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```java
// BCrypt (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
@Bean
public PasswordEncoder passwordEncoder() {
    return new BCryptPasswordEncoder();
}

// SCrypt
@Bean
public PasswordEncoder scryptPasswordEncoder() {
    return new SCryptPasswordEncoder();
}

// –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è
String rawPassword = "password123";
String encodedPassword = passwordEncoder().encode(rawPassword);
// –†–µ–∑—É–ª—å—Ç–∞—Ç: $2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBOsl7iKTVEFDa

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
boolean matches = passwordEncoder().matches(rawPassword, encodedPassword);
// –†–µ–∑—É–ª—å—Ç–∞—Ç: true
```

---

## üìù –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞

```java
package com.safronov.spring.controller;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.context.SecurityContextHolder;

@Controller
public class MyController {

    @GetMapping("/")
    public String getHomePage(Model model) {
        Authentication auth = SecurityContextHolder.getContext().getAuthentication();
        String username = auth.getName();
        model.addAttribute("username", username);
        return "home";
    }

    @GetMapping("/hr_info")
    public String getHRInfo() {
        return "hr_info";
    }

    @GetMapping("/manager_info")
    public String getManagerInfo() {
        return "manager_info";
    }

    @GetMapping("/access-denied")
    public String getAccessDenied() {
        return "access-denied";
    }
}
```

### 2. JSP —Å—Ç—Ä–∞–Ω–∏—Ü—ã

**home.jsp:**
```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<html>
<head>
    <title>–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</title>
</head>
<body>
    <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${username}!</h2>
    
    <p>–í—ã –≤–æ—à–ª–∏ –≤ —Å–∏—Å—Ç–µ–º—É –∫–∞–∫: ${username}</p>
    
    <hr>
    
    <p>
        <a href="${pageContext.request.contextPath}/hr_info">HR –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</a>
        (—Ç–æ–ª—å–∫–æ –¥–ª—è HR)
    </p>
    
    <p>
        <a href="${pageContext.request.contextPath}/manager_info">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞</a>
        (—Ç–æ–ª—å–∫–æ –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤)
    </p>
    
    <form:form action="${pageContext.request.contextPath}/logout" 
               method="POST">
        <input type="submit" value="–í—ã–π—Ç–∏"/>
    </form:form>
</body>
</html>
```

**hr_info.jsp:**
```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>HR –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</title>
</head>
<body>
    <h2>HR –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
    <p>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è HR —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤.</p>
    
    <a href="${pageContext.request.contextPath}/">–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>
</body>
</html>
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏–Ω–∞

```java
@Override
protected void configure(HttpSecurity http) throws Exception {
    http.authorizeRequests()
            .antMatchers("/").hasAnyRole("EMPLOYEE", "HR", "MANAGER")
            .antMatchers("/hr_info").hasRole("HR")
            .antMatchers("/manager_info").hasRole("MANAGER")
            .and()
            .formLogin()
                .loginPage("/showMyLoginPage")
                .loginProcessingUrl("/authenticateTheUser")
                .permitAll()
            .and()
            .logout()
                .permitAll()
            .and()
            .exceptionHandling()
                .accessDeniedPage("/access-denied");
}
```

---

## ‚ùì –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã

### Q: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –∫–∞—Å—Ç–æ–º–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞?
**A:** –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏ JSP —Å—Ç—Ä–∞–Ω–∏—Ü—É:

```java
@GetMapping("/showMyLoginPage")
public String showMyLoginPage() {
    return "custom-login";
}
```

### Q: –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ?
**A:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SecurityContextHolder:

```java
Authentication auth = SecurityContextHolder.getContext().getAuthentication();
String username = auth.getName();
Collection<? extends GrantedAuthority> authorities = auth.getAuthorities();
```

### Q: –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å CSRF –∑–∞—â–∏—Ç—É?
**A:** –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–µ–Ω–∞. –î–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è:

```java
http.csrf().disable()
```

### Q: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å Remember Me —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å?
**A:** –î–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

```java
.and().rememberMe()
    .tokenValiditySeconds(86400) // 24 —á–∞—Å–∞
```

---

## üîç –û—Ç–ª–∞–¥–∫–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –í–∫–ª—é—á–µ–Ω–∏–µ debug —Ä–µ–∂–∏–º–∞

```java
@EnableWebSecurity(debug = true)
public class MySecurityConfig extends WebSecurityConfigurerAdapter {
    // –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
}
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ application.properties

```properties
# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ Spring Security
logging.level.org.springframework.security=DEBUG
logging.level.org.springframework.web=DEBUG

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
logging.level.org.springframework.security.authentication=DEBUG
```

---

## üìä –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã Spring Security

```mermaid
sequenceDiagram
    participant U as –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    participant F as Filter Chain
    participant A as AuthenticationManager
    participant UDS as UserDetailsService
    participant PE as PasswordEncoder
    participant SC as SecurityContext
    participant C as Controller

    U->>F: HTTP Request
    F->>A: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
    A->>UDS: –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    UDS->>PE: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
    PE-->>A: –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
    A-->>F: Authentication –æ–±—ä–µ–∫—Ç
    F->>SC: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
    F->>C: –ü–µ—Ä–µ–¥–∞—á–∞ –∑–∞–ø—Ä–æ—Å–∞
    C-->>F: Response
    F-->>U: HTTP Response
```

---

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

Spring Security –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–æ—â–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ BCrypt** –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π
2. **–ü—Ä–∏–º–µ–Ω—è–π—Ç–µ –ø—Ä–∏–Ω—Ü–∏–ø –Ω–∞–∏–º–µ–Ω—å—à–∏—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π** –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Ä–æ–ª–µ–π
3. **–í–∫–ª—é—á–∞–π—Ç–µ CSRF –∑–∞—â–∏—Ç—É** –¥–ª—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
4. **–õ–æ–≥–∏—Ä—É–π—Ç–µ —Å–æ–±—ã—Ç–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
5. **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
- –ò–∑—É—á–∏—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è REST API
- –î–æ–±–∞–≤—å—Ç–µ –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
- –ò–∑—É—á–∏—Ç–µ OAuth2 –∏ OpenID Connect
